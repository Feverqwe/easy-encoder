#!/bin/sh
MES=/Packages/
TARGET="/sw"
CMPL="/compile"
mkdir ${MES}
mkdir ${TARGET}
mkdir ${CMPL}
export PATH=${TARGET}/bin:$PATH
mkdir ${MES}

#git
#mingw-get update
#mingw-get upgrade
#mingw-get install msys-wget
#mingw-get install msys-coreutils
#mingw-get install msys-tar
#mingw-get install msys-perl
#mingw-get install mingw32-pthreads-w32

if [ ! -e $MES/yasm*.tar.gz ]; then
  cd ${MES}
  echo "Download yasm*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL}
tar xzpf ${MES}/yasm*.tar.gz
cd yasm*
./configure --prefix=${TARGET} && make && make install

cd ${CMPL} 
git clone git://git.videolan.org/x264.git
cd x264
./configure --prefix=${TARGET} --enable-static && make && make install && make install-lib-static

if [ ! -e $MES/lame*.tar.gz ]; then
  cd ${MES}
  echo "Download lame*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL} 
tar xzpf ${MES}/lame*.tar.gz 
cd lame*
./configure --prefix=${TARGET} --disable-shared --enable-static && make && make install

if [ ! -e $MES/libogg*.tar.gz ]; then
  cd ${MES}
  echo "Download libogg*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL} 
tar xzpf ${MES}/libogg*.tar.gz 
cd libogg*
./configure --prefix=${TARGET} --disable-shared --enable-static && make && make install

if [ ! -e $MES/libvorbis*.tar.gz ]; then
  cd ${MES}
  echo "Download libvorbis*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL}
tar xzpf ${MES}/libvorbis*.tar.gz 
cd libvorbis*
./configure --prefix=${TARGET} --with-ogg-libraries=${TARGET}/lib --with-ogg-includes=${TARGET}/include/ --enable-static --disable-shared && make && make install

#cd ${CMPL} 
#git clone http://git.chromium.org/webm/libvpx.git
#cd libvpx*
#./configure --prefix=${TARGET} --disable-shared && make && make install

if [ ! -e $MES/vo-aacenc*.tar.gz ]; then
  cd ${MES}
  echo "Download vo-aacenc*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL}
tar xzpf ${MES}/vo-aacenc*.tar.gz 
cd vo-aacenc*
./configure --prefix=${TARGET} --disable-shared --enable-static && make && make install

cd ${CMPL}
git clone git://git.libav.org/libav.git libav
cd libav
export LDFLAGS="-L${TARGET}/lib"
export CFLAGS="-I${TARGET}/include"
# --enable-libvpx
./configure --prefix=${TARGET} --enable-runtime-cpudetect --enable-pthreads --arch=x86_64 --disable-shared --enable-static --enable-gpl --enable-libx264 --enable-libmp3lame --enable-nonfree --enable-version3 --enable-encoder=libfaac --enable-libvo-aacenc --enable-libvorbis && make clean && make && make install

cd ${CMPL}
git clone git://source.ffmpeg.org/ffmpeg.git ffmpeg
cd ffmpeg
export LDFLAGS="-L${TARGET}/lib"
export CFLAGS="-I${TARGET}/include"
./configure --prefix=${TARGET} --enable-runtime-cpudetect --enable-pthreads --arch=x86_64 --disable-shared --enable-static --enable-gpl --enable-libx264 --enable-libmp3lame --enable-nonfree --enable-version3 --enable-encoder=libfaac --enable-libvo-aacenc --enable-libvorbis && make clean && make && make install