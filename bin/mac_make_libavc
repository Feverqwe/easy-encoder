#!/bin/sh
export CC=clang
DISK_ID=$(hdid -nomount ram://2097152) 
newfs_hfs -v Ramdisk ${DISK_ID} 
diskutil mount ${DISK_ID}
MES=/tmp/Packages/
TARGET="/Volumes/Ramdisk/sw"
CMPL="/Volumes/Ramdisk/compile"
mkdir ${TARGET}
mkdir ${CMPL}
export PATH=${TARGET}/bin:$PATH
mkdir ${MES}

if [ ! -e $MES/yasm*.tar.gz ]; then
  cd ${MES}
  open .
  echo "Download yasm*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL}
tar xzpf ${MES}/yasm*.tar.gz
cd yasm*
./configure --prefix=${TARGET} && make -j 4 && make install

cd ${CMPL} 
git clone git://git.videolan.org/x264.git
cd x264
./configure --prefix=${TARGET} --enable-static && make -j 4 && make install && make install-lib-static

if [ ! -e $MES/lame*.tar.gz ]; then
  cd ${MES}
  open .
  echo "Download lame*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL} 
tar xzpf ${MES}/lame*.tar.gz 
cd lame*
./configure --prefix=${TARGET} --disable-shared --enable-static && make -j 4 && make install

if [ ! -e $MES/libogg*.tar.gz ]; then
  cd ${MES}
  open .
  echo "Download libogg*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL} 
tar xzpf ${MES}/libogg*.tar.gz 
cd libogg*
./configure --prefix=${TARGET} --disable-shared --enable-static && make -j 4 && make install

if [ ! -e $MES/libvorbis*.tar.gz ]; then
  cd ${MES}
  open .
  echo "Download libvorbis*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL} 
tar xzpf ${MES}/libvorbis*.tar.gz 
cd libvorbis*
./configure --prefix=${TARGET} --with-ogg-libraries=${TARGET}/lib --with-ogg-includes=${TARGET}/include/ --enable-static --disable-shared && make -j 4 && make install

#cd ${CMPL} 
#git clone http://git.chromium.org/webm/libvpx.git
#cd libvpx*
#./configure --prefix=${TARGET} --disable-shared && make -j 4 && make install

if [ ! -e $MES/vo-aacenc*.tar.gz ]; then
  cd ${MES}
  open .
  echo "Download vo-aacenc*.tar.gz in $MES"
  read -s -n 1
fi

cd ${CMPL} 
tar xzpf ${MES}/vo-aacenc*.tar.gz 
cd vo-aacenc*
./configure --prefix=${TARGET} --disable-shared --enable-static && make -j 4 && make install

cd ${CMPL}
git clone git://git.libav.org/libav.git libav
cd libav
export LDFLAGS="-L${TARGET}/lib" 
export CFLAGS="-I${TARGET}/include" 
# --enable-libvpx
./configure --prefix=${TARGET} --disable-shared --enable-pthreads --enable-static --enable-gpl --enable-libx264 --enable-libmp3lame --enable-nonfree --enable-version3 --enable-encoder=libfaac --enable-libvo-aacenc --enable-libvorbis && make clean && make -j 4 && make install